# FocusFlow Backend

FastAPI —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FocusFlow - —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è —Å –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–æ–º.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
backend/
‚îú‚îÄ‚îÄ main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ config.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ dependencies.py          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ FastAPI
‚îú‚îÄ‚îÄ exceptions.py            # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ models/                  # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ user.py              # –ú–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ project.py           # –ú–æ–¥–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ topic.py             # –ú–æ–¥–µ–ª–∏ —Ç–µ–º
‚îÇ   ‚îú‚îÄ‚îÄ session.py           # –ú–æ–¥–µ–ª–∏ —Å–µ—Å—Å–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ chat.py              # –ú–æ–¥–µ–ª–∏ —á–∞—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ stats.py             # –ú–æ–¥–µ–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ routers/                 # API —Ä–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ auth.py              # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ projects.py          # CRUD –ø—Ä–æ–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ topics.py            # CRUD —Ç–µ–º
‚îÇ   ‚îú‚îÄ‚îÄ sessions.py          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ ai_chat.py           # –ò–ò-—á–∞—Ç
‚îÇ   ‚îî‚îÄ‚îÄ stats.py             # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ services/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py      # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ò–ò
‚îÇ   ‚îú‚îÄ‚îÄ priority_service.py  # –†–∞—Å—á–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ stats.py             # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ database/                # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ connection.py        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ project_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ topic_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ session_repository.py
‚îÇ   ‚îî‚îÄ‚îÄ chat_repository.py
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ .env.example             # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## üì° API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/auth/login` - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

### –ü—Ä–æ–µ–∫—Ç—ã
- `GET /api/projects` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- `POST /api/projects` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
- `GET /api/projects/{id}` - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –ø–æ ID
- `PUT /api/projects/{id}` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
- `DELETE /api/projects/{id}` - –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

### –¢–µ–º—ã
- `GET /api/projects/{project_id}/topics` - –¢–µ–º—ã –ø—Ä–æ–µ–∫—Ç–∞
- `POST /api/projects/{project_id}/topics` - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–º—É
- `PUT /api/topics/{id}` - –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–º—É (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å)
- `DELETE /api/topics/{id}` - –£–¥–∞–ª–∏—Ç—å —Ç–µ–º—É
- `GET /api/topics/{id}/priority` - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–µ–º—ã

### –°–µ—Å—Å–∏–∏ –æ–±—É—á–µ–Ω–∏—è
- `POST /api/sessions/start` - –ù–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é
- `PUT /api/sessions/{id}/pause` - –ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É
- `PUT /api/sessions/{id}/resume` - –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å
- `PUT /api/sessions/{id}/complete` - –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é
- `GET /api/sessions/{id}/status` - –°—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏

### –ò–ò-—á–∞—Ç
- `POST /api/chat/message` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ò–ò
- `GET /api/chat/{session_id}/history` - –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ —Å–µ—Å—Å–∏–∏
- `DELETE /api/chat/{session_id}` - –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/stats/overview` - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/stats/projects/{id}` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `GET /api/stats/stuck-topics` - –¢–µ–º—ã —Å —á–∞—Å—Ç—ã–º–∏ –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏—è–º–∏

## üóÑ –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Project
```python
{
    "id": "uuid",
    "name": "–≠–∫–∑–∞–º–µ–Ω –ø–æ –ë–∏–æ–ª–æ–≥–∏–∏",
    "subject": "–ë–∏–æ–ª–æ–≥–∏—è",
    "deadline": "2024-05-15",
    "created_at": "2024-01-15T10:00:00Z",
    "topics": [...],
    "progress": 0.6
}
```

### Topic
```python
{
    "id": "uuid",
    "project_id": "uuid",
    "name": "–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑",
    "confidence_level": 2,  # 1-5 –∑–≤–µ–∑–¥
    "priority_score": 8.5,
    "stuck_count": 3,       # –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∑–∞—Å—Ç—Ä–µ–≤–∞–ª
    "created_at": "2024-01-15T10:00:00Z"
}
```

### Session
```python
{
    "id": "uuid",
    "topic_id": "uuid",
    "status": "active",     # active, paused, completed
    "start_time": "2024-01-15T10:00:00Z",
    "duration": 1500,       # —Å–µ–∫—É–Ω–¥—ã (25 –º–∏–Ω)
    "stuck_moments": 2,     # –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–∞–∂–∞–ª "–ó–∞—Å—Ç—Ä—è–ª"
    "completed": false
}
```

### ChatMessage
```python
{
    "id": "uuid",
    "session_id": "uuid",
    "role": "user",         # user, assistant
    "content": "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ü–∏–∫–ª –ö–∞–ª—å–≤–∏–Ω–∞?",
    "timestamp": "2024-01-15T10:05:00Z"
}
```

## ü§ñ –ò–ò-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç
```python
system_prompt = f"""
–¢—ã –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ FocusFlow.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑—É—á–∞–µ—Ç —Ç–µ–º—É: "{topic_name}"
–≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞: "{project_name}".

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
- –î–∞–≤–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–µ, –ø–æ–Ω—è—Ç–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
- –ù–µ –æ—Ç–≤–ª–µ–∫–∞—Ç—å –æ—Ç —É—á–µ–±—ã
- –ú–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å–µ—Å—Å–∏—é
- –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Å—Ç—Ä—è–ª –∏ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –ø–æ–º–æ—â–∏.
"""
```

### –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –ò–ò
- **OpenAI GPT-4** (–æ—Å–Ω–æ–≤–Ω–æ–π)
- **Google Gemini** (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
- **Anthropic Claude** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üîß –°–µ—Ä–≤–∏—Å—ã

### PriorityService
–†–∞—Å—á–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ —Ç–µ–º –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
```python
priority = (days_to_deadline ** -1) * (6 - confidence_level) * stuck_multiplier
```

### StatsService
- –ü–æ–¥—Å—á–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º
- –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø—Ä–æ–µ–∫—Ç–∞

### AIService
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —á–∞—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ò–ò

## üöÄ –ó–∞–ø—É—Å–∫

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```env
DATABASE_URL=sqlite:///./focusflow.db
OPENAI_API_KEY=your_openai_key
GEMINI_API_KEY=your_gemini_key
CORS_ORIGINS=http://localhost:3000
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
uvicorn main:app --reload --port 8000
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### SQLite (–¥–ª—è MVP)
- –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –§–∞–π–ª–æ–≤–∞—è –ë–î
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Pydantic)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ò–ò API
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ò–ò
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
pytest tests/
```

–ü–æ–∫—Ä—ã—Ç–∏–µ:
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
- Integration —Ç–µ—Å—Ç—ã –¥–ª—è API
- –ú–æ–∫-—Ç–µ—Å—Ç—ã –¥–ª—è –ò–ò –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

**–¶–µ–ª—å –±—ç–∫–µ–Ω–¥–∞**: –û–±–µ—Å–ø–µ—á–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π, –Ω–∞–¥–µ–∂–Ω—ã–π API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ò–ò-—Å–µ—Ä–≤–∏—Å–∞–º–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–π –ø–æ–º–æ—â–∏ –≤ –æ–±—É—á–µ–Ω–∏–∏.
